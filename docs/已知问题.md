# 已知问题

## 升级后 SSH 无法通过 root 用户登录

### 问题现象

不能使用 ssh 客户端通过 root 用户远程连接到迁移后的环境。

### 问题分析

OpenCloudOS 8 环境中，sshd_config 文件中的 PermitRootLogin 默认设置为 yes，所以可以直接使用 root 用户登录，如下：

```bash
[root@localhost ~]# grep PermitRootLogin /etc/ssh/sshd_config
PermitRootLogin yes
# the setting of "PermitRootLogin without-password".
[root@localhost ~]# cat /etc/os-release | grep -E '^(NAME|VERSION)='
NAME="OpenCloudOS"
VERSION="8.8"
```

检查迁移后的环境 sshd_config 配置，PermitRootLogin 结果如下：

```bash
[user@localhost ~]$ sudo cat /etc/ssh/sshd_config | grep PermitRootLogin
#PermitRootLogin prohibit-password
# the setting of "PermitRootLogin prohibit-password".
```

PermitRootLogin 的默认值被更改为 prohibit-password，这会禁止通过 root 用户密码认证的方法直接连接到迁移后的环境。

### 解决方法

使用管理员用户登录迁移后的环境，使用 vim 修改 sshd_config 文件，将 PermitRootLogin 设置为 yes。

```bash
sudo sed -i '/^#PermitRootLogin/aPermitRootLogin yes' /etc/ssh/sshd_config
sudo systemctl restart sshd
```

然后重新 ssh 使用 root 用户登录迁移后的环境，即可成功。
